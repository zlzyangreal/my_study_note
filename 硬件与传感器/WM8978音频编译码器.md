WM8978是一个低功耗、高质量的立体声多媒体数字信号编译码器。它主要应用于便携式应用。它结合了立体声差分麦克风的前置放大与扬声器、耳机和差分、立体声线输出的驱动，减少了应用时必需的外部组件，比如不需要单独的麦克风或者耳机的放大器。
高级的片上数字信号处理功能，包含一个5路均衡功能，一个用于ADC和麦克风或者线路输入之间的混合信号的电平自动控制功能，一个纯粹的录音或者重放的数字限幅功能。另外在ADC的线路上提供了一个数字滤波的功能，可以更好的应用滤波，比如“减少风噪声”。
WM8978可以被应用为一个主机或者一个从机。基于共同的参考时钟频率，比如 12MHz和13MHz，内部的PLL可以为编译码器提供所有需要的音频时钟。与STM32控制器连接使用，STM32一般作为主机，WM8978作为从机。
图9 为WM8978芯片内部结构示意图，参考来自《WM8978_v4.5》。 该图给人的第一印象感觉就是很复杂，密密麻麻很多内容，特别有很多“开关”。 实际上，每个开关对应着WM8978内部寄存器的一个位，通过控制寄存器的就可以控制开关的状态。

![图 36-0‑9 WM8978内部结构](https://doc.embedfire.com/mcu/stm32/f4/hal_general/zh/latest/_images/image99.png)

图 9 WM8978内部结构

### 1. 输入部分
WM8978结构图的左边部分是输入部分，可用于模拟声音输入，即用于录音输入。有三个输入接口，一个是由LIN和LIP、RIN和RIP组合而成的伪差分立体声麦克风输入，一个是由L2和R2组合的立体声麦克风输入，还有一个是由AUXL和AUXR组合的线输入或用来传输告警声的输入。
### 2. 输出部分
WM8978结构图的右边部分是声音放大输出部分，LOUT1和ROUT1用于耳机驱动，LOUT2和ROUT2用于扬声器驱动，OUT3和OUT4也可以配置成立体声线输出，OUT4也可以用于提供一个左右声道的单声道混合。
### 3. ADC和DAC
WM8978结构图的中边部分是芯片核心内容，处理声音的AD和DA转换。ADC部分对声音输入进行处理，包括ADC滤波处理、音量控制、输入限幅器/电平自动控制等等。DAC部分控制声音输出效果，包括DAC5路均衡器、DAC 3D放大、DAC输出限幅以及音量控制等等处理。
### 4. 通信接口
WM8978有两个通信接口，一个是数字音频通信接口，另外一个是控制接口。音频接口是采用I2S接口，支持左对齐、右对齐和I2S标准模式，以及DSP模式A和模拟B。控制接口用于控制器发送控制命令配置WM8978运行状态，它提供2线或3线控制接口，对于STM32控制器，我们选择2线接口方式，它实际就是I2C总线方式，其芯片地址固定为0011010。通过控制接口可以访问WM8978内部寄存器，实现芯片工作环境配置，总共有58个寄存器，表示为R0至R57，限于篇幅问题这里不再深入探究，每个寄存器意义参考《WM8978_v4.5》了解。
WM8978寄存器是16bit长度，高7位(`[15:9]bit`)用于表示寄存器地址，低9为有实际意义，比如对于图 38‑9中的某个开关。所以在控制器向芯片发送控制命令时，必须传输长度为16bit的指令，芯片会根据接收命令高7位值寻址。
### 5. 其他部分
WM8978作为主从机都必须对时钟进行管理，由内部PLL单元控制。另外还有电源管理单元。